var validArgs=function(){for(var e=[],t=PPx.Arguments;!t.atEnd();t.moveNext())e.push(t.value);return e},e={ppmName:"ppx-plugin-manager",ppmVersion:.95,language:"ja",encode:"utf16le",nlcode:"\r\n",nltype:"crlf",ppmID:"P",ppmSubID:"Q"},useLanguage=function(){var t=PPx.Extract("%*getcust(S_ppm#global:lang)");return"en"===t||"ja"===t?t:e.language},t=PPx.CreateObject("Scripting.FileSystemObject"),isEmptyStr=function(e){return""===e},expandNlCode=function(e){var t="\n",r=e.indexOf("\r");return~r&&(t="\r\n"==e.substring(r,r+2)?"\r\n":"\r"),t},isCV8=function(){return"ClearScriptV8"===PPx.ScriptEngineName},r={TypeToCode:{crlf:"\r\n",cr:"\r",lf:"\n"},CodeToType:{"\r\n":"crlf","\r":"cr","\n":"lf"},Ppx:{lf:"%%bl",cr:"%%br",crlf:"%%bn",unix:"%%bl",mac:"%%br",dos:"%%bn","\n":"%%bl","\r":"%%br","\r\n":"%%bn"},Ascii:{lf:"10",cr:"13",crlf:"-1",unix:"10",mac:"13",dos:"-1","\n":"10","\r":"13","\r\n":"-1"}},exec=function(e,t){try{var r;return[!1,null!=(r=t())?r:""]}catch(n){return[!0,""]}finally{e.Close()}},read=function(e){var r=e.path,n=e.enc,i=void 0===n?"utf8":n;if(!t.FileExists(r))return[!0,r+" not found"];var a=t.GetFile(r);if(0===a.Size)return[!0,r+" has no data"];var l=!1,o="";if("utf8"===i){var u=PPx.CreateObject("ADODB.Stream"),c=exec(u,(function(){return u.Open(),u.Charset="UTF-8",u.LoadFromFile(r),u.ReadText(-1)}));l=c[0],o=c[1]}else{var s="utf16le"===i?-1:0,f=a.OpenAsTextStream(1,s),d=exec(f,(function(){return f.ReadAll()}));l=d[0],o=d[1]}return l?[!0,"Unable to read "+r]:[!1,o]},readLines=function(e){var t,r=e.path,n=e.enc,i=void 0===n?"utf8":n,a=e.linefeed,l=read({path:r,enc:i}),o=l[0],u=l[1];if(o)return[!0,u];a=null!=(t=a)?t:expandNlCode(u.slice(0,1e3));var c=u.split(a);return isEmptyStr(c[c.length-1])&&c.pop(),[!1,{lines:c,nl:a}]},writeLines=function(n){var i=n.path,a=n.data,l=n.enc,o=void 0===l?"utf8":l,u=n.append,c=void 0!==u&&u,s=n.overwrite,f=void 0!==s&&s,d=n.linefeed,x=void 0===d?e.nlcode:d;if(!f&&!c&&t.FileExists(i))return[!0,i+" already exists"];var p,P=t.GetParentFolderName(i);if(t.FolderExists(P)||PPx.Execute("*makedir "+P),"utf8"===o){if(isCV8()){var v=a.join(x),m=c?"AppendAllText":"WriteAllText";return[!1,NETAPI.System.IO.File[m](i,v)]}var E=f||c?2:1,b=PPx.CreateObject("ADODB.Stream");p=exec(b,(function(){b.Open(),b.Charset="UTF-8",b.LineSeparator=Number(r.Ascii[x]),c?(b.LoadFromFile(i),b.Position=b.Size,b.SetEOS):b.Position=0,b.WriteText(a.join(x),1),b.SaveToFile(i,E)}))[0]}else{var g=c?8:f?2:1;t.FileExists(i)||PPx.Execute("%Osq *makefile "+i);var F="utf16le"===o?-1:0,S=t.GetFile(i).OpenAsTextStream(g,F);p=exec(S,(function(){S.Write(a.join(x)+x)}))[0]}return p?[!0,"Could not write to "+i]:[!1,""]},fileEnc=function(t){return"utf8"===t||"sjis"===t?t:e.encode},_dotEntries=function(){var e=PPx.Extract("%*getcust(XC_tdir)").split(","),t=e[0],r=e[1];return Number(t)+Number(r)},getIndex=function(e){for(var t=0;e.length>t&&0===e[t].indexOf(";");)t++;return PPx.Entry.Index+_dotEntries()+t},n="%sgu'ppmcache'\\complist\\attributes.txt",i={en:{couldNotRead:"Could not read ListFile",couldNotGetEntry:"Could not get entry information"},ja:{couldNotRead:"リストファイルを読み込めませんでした",couldNotGetEntry:"エントリ情報を取得できませんでした"}}[useLanguage()],main=function(){var e=validArgs()[0],r=PPx.Extract("%R");if(t.FileExists(r)||t.FolderExists(r))PPx.Execute('%K"@A"');else{var a=PPx.DirectoryType;if(4===a){var l=PPx.Extract("%FDV"),o=fileEnc(e),u=readLines({path:l,enc:o}),c=u[0],s=u[1];c&&(PPx.linemessage('!"'+i.couldNotRead),PPx.Quit(-1));var f=getIndex(s.lines),d=s.lines[f];if(~d.indexOf(r)){var x=/^(.+",A:H)(\d+)(,.+)$/,p="'title': '"+"%*getcust(Mes0411:7800)"+" : "+getAttbibute(x,d)+"','mode':'e','list':'on','module':'off','detail':'user1','leavecancel':false,'file':'"+n+"'",P=PPx.Extract('%*script("%sgu\'ppmlib\'\\input.js","{'+p+'}")');if("[error]"!==P&&!isEmptyStr(P)){s.lines[f]=d.replace(x,"$1"+P+"$3");var v=writeLines({data:s.lines,path:l,enc:o,linefeed:s.nl,overwrite:!0}),m=v[0],E=v[1];m&&(PPx.Echo(E),PPx.Quit(-1)),4===a&&PPx.Execute("*wait 100,1%:*jumppath -savelocate")}}else PPx.linemessage('!"'+i.couldNotGetEntry)}}},getAttbibute=function(e,t){var r=e.exec(t);return r?r[2]:"-"};main();
