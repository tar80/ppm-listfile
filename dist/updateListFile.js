var e={ppmName:"ppx-plugin-manager",ppmVersion:.95,language:"ja",encode:"utf16le",nlcode:"\r\n",nltype:"crlf",ppmID:"P",ppmSubID:"Q"},useLanguage=function(){var t=PPx.Extract("%*getcust(S_ppm#global:lang)");return"en"===t||"ja"===t?t:e.language},t=PPx.CreateObject("Scripting.FileSystemObject"),isEmptyStr=function(e){return""===e},isZero=function(e){return null!=e&&("0"===e||0===e)},withinRange=function(e,t){return 0<=e&&e<=Number(t)},n={TypeToCode:{crlf:"\r\n",cr:"\r",lf:"\n"},CodeToType:{"\r\n":"crlf","\r":"cr","\n":"lf"},Ppx:{lf:"%%bl",cr:"%%br",crlf:"%%bn",unix:"%%bl",mac:"%%br",dos:"%%bn","\n":"%%bl","\r":"%%br","\r\n":"%%bn"},Ascii:{lf:"10",cr:"13",crlf:"-1",unix:"10",mac:"13",dos:"-1","\n":"10","\r":"13","\r\n":"-1"}},expandNlCode=function(e){var t="\n",n=e.indexOf("\r");return~n&&(t="\r\n"===e.substring(n,n+2)?"\r\n":"\r"),t},isCV8=function(){return"ClearScriptV8"===PPx.ScriptEngineName},confirmFileEncoding=function(t){return"utf8"===t||"sjis"===t?t:e.encode},_exec=function(e,t){try{var n;return[!1,null!=(n=t())?n:""]}catch(r){return[!0,""]}finally{e.Close()}},read=function(e){var n=e.path,r=e.enc,i=void 0===r?"utf8":r;if(!t.FileExists(n))return[!0,n+" not found"];var a=t.GetFile(n);if(0===a.Size)return[!0,n+" has no data"];var l=!1,u="";if("utf8"===i){var o=PPx.CreateObject("ADODB.Stream"),c=_exec(o,(function(){return o.Open(),o.Charset="UTF-8",o.LoadFromFile(n),o.ReadText(-1)}));l=c[0],u=c[1]}else{var d="utf16le"===i?-1:0,f=a.OpenAsTextStream(1,d),s=_exec(f,(function(){return f.ReadAll()}));l=s[0],u=s[1]}return l?[!0,"Unable to read "+n]:[!1,u]},readLines=function(e){var t,n=e.path,r=e.enc,i=void 0===r?"utf8":r,a=e.linefeed,l=read({path:n,enc:i}),u=l[0],o=l[1];if(u)return[!0,o];a=null!=(t=a)?t:expandNlCode(o.slice(0,1e3));var c=o.split(a);return isEmptyStr(c[c.length-1])&&c.pop(),[!1,{lines:c,nl:a}]},writeLines=function(r){var i=r.path,a=r.data,l=r.enc,u=void 0===l?"utf8":l,o=r.append,c=void 0!==o&&o,d=r.overwrite,f=void 0!==d&&d,s=r.linefeed,x=void 0===s?e.nlcode:s;if(!f&&!c&&t.FileExists(i))return[!0,i+" already exists"];var P,p=t.GetParentFolderName(i);if(t.FolderExists(p)||PPx.Execute("*makedir "+p),"utf8"===u){if(isCV8()){var v=a.join(x),m=c?"AppendAllText":"WriteAllText";return[!1,NETAPI.System.IO.File[m](i,v)]}var g=f||c?2:1,E=PPx.CreateObject("ADODB.Stream");P=_exec(E,(function(){E.Open(),E.Charset="UTF-8",E.LineSeparator=Number(n.Ascii[x]),c?(E.LoadFromFile(i),E.Position=E.Size,E.SetEOS):E.Position=0,E.WriteText(a.join(x),1),E.SaveToFile(i,g)}))[0]}else{var b=c?8:f?2:1;t.FileExists(i)||PPx.Execute("%Osq *makefile "+i);var h="utf16le"===u?-1:0,F=t.GetFile(i).OpenAsTextStream(b,h);P=_exec(F,(function(){F.Write(a.join(x)+x)}))[0]}return P?[!0,"Could not write to "+i]:[!1,""]},validArgs=function(){for(var e=[],t=PPx.Arguments;!t.atEnd();t.moveNext())e.push(t.value);return e},keepState=function(e,t,n){var r=/^(.+S:[\d\.]+)(,R:[\d\.]+)?(X:\d+)?(H:\d+)?(M:(-1|0|1))?(,T:"(.+)")?(.*)$/;return e.replace(r,"$1$2$3"+t+n+"$7$9")},r={en:{failedRewrite:"Failed to rewrite",couldNotRead:"Could not read ListFile",couldNotGetEntry:"Could not get entry information",undoable:"(Undoable)",rename:"Rename virtual entry"},ja:{failedRewrite:"書き換えに失敗しました",couldNotRead:"リストファイルを読み込めませんでした",couldNotGetEntry:"エントリ情報を取得できませんでした",undoable:"(Undo有効)",rename:"仮想エントリ名の変更"}}[useLanguage()],main=function(){var t=validArgs()[0],n=PPx.Extract("%FDV").replace("::listfile","");0!==PPx.Execute('%K"@w"')&&(PPx.linemessage('!"'+r.failedRewrite),PPx.Quit(-1));var i=confirmFileEncoding(t),a=readLines({path:n,enc:i,linefeed:e.nlcode}),l=a[0],u=a[1];l&&(PPx.linemessage('!"'+r.couldNotRead),PPx.Quit(-1));for(var o=PPx.Entry.AllEntry;!o.atEnd();o.moveNext()){var c=o.Highlight>0&&withinRange(o.Highlight,7)?",H:"+o.Highlight:"",d=isZero(o.Mark)?"":",M:1";if(!isEmptyStr(c)||!isEmptyStr(d))for(var f=0,s=u.lines.length;f<s;f++){var x=u.lines[f];~x.indexOf(o.Name)&&(u.lines[f]=keepState(x,c,d))}}var P=writeLines({path:n,data:u.lines,enc:i,linefeed:u.nl,overwrite:!0}),p=P[0],v=P[1];p&&(PPx.linemessage('!"'+v),PPx.Quit(-1)),ignoreSaveComment()},ignoreSaveComment=function(){var e="XC_cwrt",t="ppm_lf_update",n="KC_main:LOADEVENT",r=PPx.Extract("%*getcust("+e+")");PPx.Execute("*setcust "+e+"=0"),PPx.Execute("*linecust "+t+","+n+",*setcust "+e+"="+r+"%%:*linecust "+t+","+n+",")};main();
