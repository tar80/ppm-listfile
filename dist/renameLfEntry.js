var validArgs=function(){for(var e=[],t=PPx.Arguments;!t.atEnd();t.moveNext())e.push(t.value);return e},safeArgs=function(){for(var e=[],t=validArgs(),n=0,r=arguments.length;n<r;n++)e.push(_valueConverter(n<0||arguments.length<=n?undefined:arguments[n],t[n]));return e},_valueConverter=function(e,t){if(null==t||""===t)return null!=e?e:undefined;switch(typeof e){case"number":var n=Number(t);return isNaN(n)?e:n;case"boolean":return"false"!==t&&"0"!==t&&null!=t;default:return t}},e={ppmName:"ppx-plugin-manager",ppmVersion:.95,language:"ja",encode:"utf16le",nlcode:"\r\n",nltype:"crlf",ppmID:"P",ppmSubID:"Q"},useLanguage=function(){var t=PPx.Extract("%*getcust(S_ppm#global:lang)");return"en"===t||"ja"===t?t:e.language},t=PPx.CreateObject("Scripting.FileSystemObject"),isEmptyStr=function(e){return""===e},isZero=function(e){return"string"==typeof e?"0"===e:0===e},expandNlCode=function(e){var t="\n",n=e.indexOf("\r");return~n&&(t="\r\n"==e.substring(n,n+2)?"\r\n":"\r"),t},isCV8=function(){return"ClearScriptV8"===PPx.ScriptEngineName},n={TypeToCode:{crlf:"\r\n",cr:"\r",lf:"\n"},CodeToType:{"\r\n":"crlf","\r":"cr","\n":"lf"},Ppx:{lf:"%%bl",cr:"%%br",crlf:"%%bn",unix:"%%bl",mac:"%%br",dos:"%%bn","\n":"%%bl","\r":"%%br","\r\n":"%%bn"},Ascii:{lf:"10",cr:"13",crlf:"-1",unix:"10",mac:"13",dos:"-1","\n":"10","\r":"13","\r\n":"-1"}},exec=function(e,t){try{var n;return[!1,null!=(n=t())?n:""]}catch(r){return[!0,""]}finally{e.Close()}},read=function(e){var n=e.path,r=e.enc,i=void 0===r?"utf8":r;if(!t.FileExists(n))return[!0,n+" not found"];var a=t.GetFile(n);if(0===a.Size)return[!0,n+" has no data"];var l=!1,u="";if("utf8"===i){var o=PPx.CreateObject("ADODB.Stream"),c=exec(o,(function(){return o.Open(),o.Charset="UTF-8",o.LoadFromFile(n),o.ReadText(-1)}));l=c[0],u=c[1]}else{var f="utf16le"===i?-1:0,s=a.OpenAsTextStream(1,f),d=exec(s,(function(){return s.ReadAll()}));l=d[0],u=d[1]}return l?[!0,"Unable to read "+n]:[!1,u]},readLines=function(e){var t,n=e.path,r=e.enc,i=void 0===r?"utf8":r,a=e.linefeed,l=read({path:n,enc:i}),u=l[0],o=l[1];if(u)return[!0,o];a=null!=(t=a)?t:expandNlCode(o.slice(0,1e3));var c=o.split(a);return isEmptyStr(c[c.length-1])&&c.pop(),[!1,{lines:c,nl:a}]},writeLines=function(r){var i=r.path,a=r.data,l=r.enc,u=void 0===l?"utf8":l,o=r.append,c=void 0!==o&&o,f=r.overwrite,s=void 0!==f&&f,d=r.linefeed,p=void 0===d?e.nlcode:d;if(!s&&!c&&t.FileExists(i))return[!0,i+" already exists"];var x,P=t.GetParentFolderName(i);if(t.FolderExists(P)||PPx.Execute("*makedir "+P),"utf8"===u){if(isCV8()){var m=a.join(p),v=c?"AppendAllText":"WriteAllText";return[!1,NETAPI.System.IO.File[v](i,m)]}var E=s||c?2:1,g=PPx.CreateObject("ADODB.Stream");x=exec(g,(function(){g.Open(),g.Charset="UTF-8",g.LineSeparator=Number(n.Ascii[p]),c?(g.LoadFromFile(i),g.Position=g.Size,g.SetEOS):g.Position=0,g.WriteText(a.join(p),1),g.SaveToFile(i,E)}))[0]}else{var b=c?8:s?2:1;t.FileExists(i)||PPx.Execute("%Osq *makefile "+i);var F="utf16le"===u?-1:0,y=t.GetFile(i).OpenAsTextStream(b,F);x=exec(y,(function(){y.Write(a.join(p)+p)}))[0]}return x?[!0,"Could not write to "+i]:[!1,""]},fileEnc=function(t){return"utf8"===t||"sjis"===t?t:e.encode},r={en:{failedRewrite:"Failed to rewrite",couldNotRead:"Could not read ListFile",couldNotGetEntry:"Could not get entry information",undoable:"(Undoable)"},ja:{failedRewrite:"書き換えに失敗しました",couldNotRead:"リストファイルを読み込めませんでした",couldNotGetEntry:"エントリ情報を取得できませんでした",undoable:"(Undo有効)"}}[useLanguage()],main=function(){var n=safeArgs(!1,e.encode),i=n[0],a=n[1],l=PPx.DirectoryType;if(PPx.EntryState<2&&PPx.Quit(-1),4!==l)return l;var u=PPx.Extract("%FDCN"),o=fileEnc(a);if(t.FileExists(u)||t.FolderExists(u))return doRename(i),4;var c=PPx.Extract('%*input("%C" -title:"%*getcust(Mes0411:TREN)" -mode:Ec -k *cursor -8%%:*mapkey use,K_ppmRename)'),f=PPx.Extract();if(!isZero(f)||isEmptyStr(c))return 4;var s=PPx.Extract("%FDV"),d=readLines({path:s,enc:o,linefeed:e.nlcode}),p=d[0],x=d[1];p&&(PPx.linemessage('!"'+r.couldNotRead),PPx.Quit(-1));for(var P=PPx.Extract("%R"),m=/^"[^"]+",(.+)$/,v=0,E=x.lines.length;v<E;v++){var g=x.lines[v];1===g.indexOf(P)&&(x.lines[v]=g.replace(m,'"'+c+'",$1'))}var b=writeLines({path:s,data:x.lines,enc:o,overwrite:!0,linefeed:x.nl}),F=b[0],y=b[1];return F&&(PPx.linemessage('!"'+y),PPx.Quit(-1)),PPx.Execute('*wait 100,1%:*jumppath -entry:"'+c+'"'),4},doRename=function(e){var t=e?'*ppcfile !rename -min -same:skip -error:dialog -undolog:on -log:off -name:"%*input("%C" -title:"%*getcust(Mes0411:TREN)'+r.undoable+'" -mode:Ec -k *cursor -8%%:*mapkey use,K_ppmRename)"':'%K"@R"';PPx.Execute(t)};PPx.result=main();
