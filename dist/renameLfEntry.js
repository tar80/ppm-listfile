var validArgs=function(){for(var e=[],t=PPx.Arguments;!t.atEnd();t.moveNext())e.push(t.value);return e},safeArgs=function(){for(var e=[],t=validArgs(),r=0,n=arguments.length;r<n;r++)e.push(_valueConverter(r<0||arguments.length<=r?undefined:arguments[r],t[r]));return e},_valueConverter=function(e,t){if(null==t||""===t)return null!=e?e:undefined;switch(typeof e){case"number":var r=Number(t);return Number.isNaN(r)?e:r;case"boolean":return null!=t&&"false"!==t&&"0"!==t;default:return t}},e={ppmName:"ppx-plugin-manager",ppmVersion:.95,language:"ja",encode:"utf16le",nlcode:"\r\n",nltype:"crlf",ppmID:"P",ppmSubID:"Q"},useLanguage=function(){var t=PPx.Extract("%*getcust(S_ppm#global:lang)");return"en"===t||"ja"===t?t:e.language},t=PPx.CreateObject("Scripting.FileSystemObject"),isEmptyStr=function(e){return""===e},isZero=function(e){return null!=e&&("0"===e||0===e)},r={TypeToCode:{crlf:"\r\n",cr:"\r",lf:"\n"},CodeToType:{"\r\n":"crlf","\r":"cr","\n":"lf"},Ppx:{lf:"%%bl",cr:"%%br",crlf:"%%bn",unix:"%%bl",mac:"%%br",dos:"%%bn","\n":"%%bl","\r":"%%br","\r\n":"%%bn"},Ascii:{lf:"10",cr:"13",crlf:"-1",unix:"10",mac:"13",dos:"-1","\n":"10","\r":"13","\r\n":"-1"}},expandNlCode=function(e){var t="\n",r=e.indexOf("\r");return~r&&(t="\r\n"===e.substring(r,r+2)?"\r\n":"\r"),t},isCV8=function(){return"ClearScriptV8"===PPx.ScriptEngineName},confirmFileEncoding=function(t){return"utf8"===t||"sjis"===t?t:e.encode},_exec=function(e,t){try{var r;return[!1,null!=(r=t())?r:""]}catch(n){return[!0,""]}finally{e.Close()}},read=function(e){var r=e.path,n=e.enc,i=void 0===n?"utf8":n;if(!t.FileExists(r))return[!0,r+" not found"];var a=t.GetFile(r);if(0===a.Size)return[!0,r+" has no data"];var l=!1,u="";if("utf8"===i){var o=PPx.CreateObject("ADODB.Stream"),c=_exec(o,(function(){return o.Open(),o.Charset="UTF-8",o.LoadFromFile(r),o.ReadText(-1)}));l=c[0],u=c[1]}else{var f="utf16le"===i?-1:0,d=a.OpenAsTextStream(1,f),s=_exec(d,(function(){return d.ReadAll()}));l=s[0],u=s[1]}return l?[!0,"Unable to read "+r]:[!1,u]},readLines=function(e){var t,r=e.path,n=e.enc,i=void 0===n?"utf8":n,a=e.linefeed,l=read({path:r,enc:i}),u=l[0],o=l[1];if(u)return[!0,o];a=null!=(t=a)?t:expandNlCode(o.slice(0,1e3));var c=o.split(a);return isEmptyStr(c[c.length-1])&&c.pop(),[!1,{lines:c,nl:a}]},writeLines=function(n){var i=n.path,a=n.data,l=n.enc,u=void 0===l?"utf8":l,o=n.append,c=void 0!==o&&o,f=n.overwrite,d=void 0!==f&&f,s=n.linefeed,x=void 0===s?e.nlcode:s;if(!d&&!c&&t.FileExists(i))return[!0,i+" already exists"];var P,p=t.GetParentFolderName(i);if(t.FolderExists(p)||PPx.Execute("*makedir "+p),"utf8"===u){if(isCV8()){var m=a.join(x),v=c?"AppendAllText":"WriteAllText";return[!1,NETAPI.System.IO.File[v](i,m)]}var b=d||c?2:1,E=PPx.CreateObject("ADODB.Stream");P=_exec(E,(function(){E.Open(),E.Charset="UTF-8",E.LineSeparator=Number(r.Ascii[x]),c?(E.LoadFromFile(i),E.Position=E.Size,E.SetEOS):E.Position=0,E.WriteText(a.join(x),1),E.SaveToFile(i,b)}))[0]}else{var F=c?8:d?2:1;t.FileExists(i)||PPx.Execute("%Osq *makefile "+i);var g="utf16le"===u?-1:0,h=t.GetFile(i).OpenAsTextStream(F,g);P=_exec(h,(function(){h.Write(a.join(x)+x)}))[0]}return P?[!0,"Could not write to "+i]:[!1,""]},n={en:{failedRewrite:"Failed to rewrite",couldNotRead:"Could not read ListFile",couldNotGetEntry:"Could not get entry information",undoable:"(Undoable)",rename:"Rename virtual entry"},ja:{failedRewrite:"書き換えに失敗しました",couldNotRead:"リストファイルを読み込めませんでした",couldNotGetEntry:"エントリ情報を取得できませんでした",undoable:"(Undo有効)",rename:"仮想エントリ名の変更"}}[useLanguage()],main=function(){var r=safeArgs(e.encode)[0],i=PPx.DirectoryType;if(PPx.EntryState<2&&PPx.Quit(-1),4!==i)return i;var a=PPx.Extract("%FDCN"),l=confirmFileEncoding(r);if(t.FileExists(a)||t.FolderExists(a))return PPx.Execute('%K"@R"'),4;var u=PPx.Extract('%*input("%C" -title:"'+n.rename+'" -mode:Ec -k *cursor -8%%:*mapkey use,K_ppmRename)'),o=PPx.Extract();if(!isZero(o)||isEmptyStr(u))return 4;var c=PPx.Extract("%FDV"),f=readLines({path:c,enc:l,linefeed:e.nlcode}),d=f[0],s=f[1];d&&(PPx.linemessage('!"'+n.couldNotRead),PPx.Quit(-1));for(var x=PPx.Extract("%R"),P=/^"[^"]+",(.+)$/,p=0,m=s.lines.length;p<m;p++){var v=s.lines[p];1===v.indexOf(x)&&(s.lines[p]=v.replace(P,'"'+u+'",$1'))}var b=writeLines({path:c,data:s.lines,enc:l,overwrite:!0,linefeed:s.nl}),E=b[0],F=b[1];return E&&(PPx.linemessage('!"'+F),PPx.Quit(-1)),PPx.Execute('*wait 100,1%:*jumppath -entry:"'+u+'"'),4};PPx.result=main();
